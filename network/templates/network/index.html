{% load static %}

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Quotes</title>
    <link rel="icon" type="image/x-icon" href="/media/favicon/favicon.ico">
    <link href="{% static 'network/bootstrap-5.2.3-dist/css/bootstrap.min.css' %}" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="{% static 'network/styles.css' %}" rel="stylesheet">
  </head>
  <body>

    <nav class="bg-transparent">
      <div class="dropdown d-flex flex-column align-items-center">

        <a href="{% url 'index' %}" class="" title="Flush Posts" alt="Flush Posts">
          <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" fill="currentColor" class="bi bi-chat-square-quote-fill" viewBox="0 0 16 16">
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#F2D65D"/>
              <stop offset="25%" stop-color="#FFD283"/>
              <stop offset="50%" stop-color="#FFE9A9"/>
              <stop offset="75%" stop-color="#C6FFC9"/>
              <stop offset="100%" stop-color="#A6FFFF"/>
            </linearGradient>
            <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#F0C030"/>
              <stop offset="25%" stop-color="#FFC848"/>
              <stop offset="50%" stop-color="#FFE070"/>
              <stop offset="75%" stop-color="#9FFF9F"/>
              <stop offset="100%" stop-color="#50FFFF"/>
            </linearGradient>
            <path fill="url(#gradient)" d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.5a1 1 0 0 0-.8.4l-1.9 2.533a1 1 0 0 1-1.6 0L5.3 12.4a1 1 0 0 0-.8-.4H2a2 2 0 0 1-2-2V2zm7.194 2.766a1.688 1.688 0 0 0-.227-.272 1.467 1.467 0 0 0-.469-.324l-.008-.004A1.785 1.785 0 0 0 5.734 4C4.776 4 4 4.746 4 5.667c0 .92.776 1.666 1.734 1.666.343 0 .662-.095.931-.26-.137.389-.39.804-.81 1.22a.405.405 0 0 0 .011.59c.173.16.447.155.614-.01 1.334-1.329 1.37-2.758.941-3.706a2.461 2.461 0 0 0-.227-.4zM11 7.073c-.136.389-.39.804-.81 1.22a.405.405 0 0 0 .012.59c.172.16.446.155.613-.01 1.334-1.329 1.37-2.758.942-3.706a2.466 2.466 0 0 0-.228-.4 1.686 1.686 0 0 0-.227-.273 1.466 1.466 0 0 0-.469-.324l-.008-.004A1.785 1.785 0 0 0 10.07 4c-.957 0-1.734.746-1.734 1.667 0 .92.777 1.666 1.734 1.666.343 0 .662-.095.931-.26z"/>
          </svg>
        </a>
        <button class="btn dropdown-toggle border-0" type="button" data-bs-toggle="dropdown"></button>
        <ul class="dropdown dropdown-menu border-0 bg-transparent">
          {% if user.is_authenticated %}
          <li>
            <!-- NEW POST -->
            <a href="#" data-bs-toggle="modal" data-bs-target="#modal-newpost" class="dropdown-item rounded-pill link-info align-self-center" title="New Post" alt="New Post">
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
              </svg>
            </a>
          </li>

          <li>
          <!-- PROFILE -->
            <a onclick="profile({{user.id}})" data-bs-toggle="modal" href="#modal-profile" class="dropdown-item rounded-pill link-warning align-self-center" title="Profile" alt="Profile">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
              </svg>
            </a>
          </li>

          <li>
          <!-- FOLLOWING POSTS -->
            <a href="{% url 'following' %}" class="dropdown-item rounded-pill link-success" title="Following" alt="Following">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-person-heart" viewBox="0 0 16 16">
                <path d="M9 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm-9 8c0 1 1 1 1 1h10s1 0 1-1-1-4-6-4-6 3-6 4Zm13.5-8.09c1.387-1.425 4.855 1.07 0 4.277-4.854-3.207-1.387-5.702 0-4.276Z"/>
              </svg>
            </a>
          </li>

          <li>
          <!-- LOGOUT -->
            <a href="{% url 'logout' %}" class="dropdown-item rounded-pill link-danger" title="Log Out" alt="Log Out">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-arrow-down-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"/>
              </svg>
            </a>

          </li>

          {% else %}
          <!-- LOGIN -->
            <a href="{% url 'login' %}" class="dropdown-item rounded-pill link-success" title="Log In" alt="Log In">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-arrow-up-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 0 0 8a8 8 0 0 0 16 0zm-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"/>
              </svg>
            </a>
          <li>
          {% endif %}
        </ul>
      </div>
    </nav>

    <section id="paginator" class="bg transparent d-flex">
      <!-- PAGE BUTTONS -->
      {% if next != prev %}
      <div id="paginator-btn" class="container">
        <button type="button" class="btn p-0 border border-0 px-1" {{prev}}>
          <a href="?page={{prev}}">
            <svg id="prev-btn" xmlns="http://www.w3.org/2000/svg" width="18" height="18" transform="rotate(180)" viewBox="0 0 512 512"><path d="M470.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 256 265.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160zm-352 160l160-160c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L210.7 256 73.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0z"/></svg>
          </a>
        </button>
        <button type="button" class="btn p-0 border border-0 px-1" {{next}}>
          <a href="?page={{next}}">
            <svg id="next-btn" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 512 512"><path d="M470.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 256 265.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160zm-352 160l160-160c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L210.7 256 73.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0z"/></svg>
          </a>
        </button>
      </div>
      {% endif %}
    </section>

    <!-- MAIN -->
    <main class="container grid">
    <!-- ALL POSTS -->
    {% for post in posts %}
      <div class="card shadow">

        <div class="card-image">
          <img src="{{ post.by.user.profile.picurl }}" class="img-fluid" alt="Profile Pic">
        </div>

        <div class="card-body">

          <h6 class="card-subtitle mb-2 text-muted" style="font-size: 0.7rem;">
            <time datetime="2016-1-1">{{post.date}}</time>
            {% if user in post.likes.all %}
            <svg class="btn-like active" id="post-{{post.id}}" width="14" height="14" viewBox="0 0 512 512"><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>  
            {% else %}
            <svg class="btn-like" id="post-{{post.id}}" width="14" height="14" viewBox="0 0 512 512"><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>  
            {% endif %}
            (<span id="like-count-{{post.id}}">{{ post.get_likes }}</span>)
          </h6>

          <h5 class="card-title">
            <a class="link-dark text-decoration-none" data-bs-toggle="modal" href="#modal-profile" onclick="profile({{post.by.user.id}})">
              {{post.by.user.username}}
            </a>
          </h5>

          <p class="card-text" id="content">
            {{post.content}}     
            {% if user.username == post.by.user.username %}
            <div>
              <a href="#" class="link-dark text-decoration-none" id="{{post.id}}" onclick="edit(event)">[edit]</a>
            </div>
            {% endif %}
          </p>

        </div>
      </div>
    {% endfor %}
    </main>

    <!-- MODALS -->

    <!-- MODAL NEW POST -->
    <section class="modal fade" id="modal-newpost" tabindex="-1" aria-labelledby="modal-newpost" style="display: none;" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="gridModalLabel">New Post</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="post-form" class="" action="#" method="POST">
              {% csrf_token %}
              {{ form }}
            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn btn-sm btn-light" id="post-btn" form="post-form" >Post</button>
          </div>
        </div>
      </div>   
    </section>

    <!-- MODAL PROFILE -->
    <section class="modal fade" id="modal-profile" tabindex="-1" aria-labelledby="modal-profile" style="display: none;" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header align-items-baseline">
            <h1 class="modal-title fs-5" id="profile-user">Profile</h1>
              <div class="text-muted p-2">[ 
                Following:
                <span id="profile-following"></span>
              </div>
              <div class="text-muted p-2">
                Followers:
                <span id="profile-followers"></span>
              </div>
              <div class="text-muted p-2">
                Posts:
                <span id="profile-posts"></span> ]
              </div>        
              <button id="btn-follow" type="button" class="btn mx-2 btn-sm btn-light d-none" aria-label="follow"></button>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="container-fluid bd-example-row">
              <div class="row">
                <div class="col-md-6">
                  <div class="row profile-pic">
                  <img id="profile-pic" class="profile-pic img-thumbnail border border-0" id="profile-pic" src="#" alt="Profile Picture">   
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <p id="profile-about" class="fs-5 fw-light text-muted">
                    </p>
                  </div>
                </div>             
              </div>
              <form class="d-none">
                {{ picForm }}
              </form>
          </div>
        </div>
      </div>
    </section>

    <!-- MODAL EDIT PROFILE -->
    <section class="modal fade" id="modal-edit-profile" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="gridModalLabel">Edit Profile</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            {% csrf_token %}
            {{ form }}
          </div>
          <div class="modal-footer">
            <button id="profile-save-button" type="button" class="btn btn-sm btn-light">Save</button>
            <button id="profile-back-button" class="btn btn-sm btn-light" data-bs-target="#modal-profile" data-bs-toggle="modal">Back</button>
          </div>
        </div>
      </div>   
    </section>


    <!-- MODAL EDIT POST -->
    <section class="modal fade" id="modal-edit" tabindex="-1" aria-labelledby="modal-edit" style="display: none;" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="gridModalLabel">Edit Post</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            {% csrf_token %}
            {{ form }}
          </div>
          <div class="modal-footer">
            <button id="save-button" type="button" class="btn btn-sm btn-light">Save</button>
          </div>
        </div>
      </div>   
    </section>

    <footer class="text-center py-3">     
      2022, mnm
    </footer>

    <script src="{% static 'network/bootstrap-5.2.3-dist/js/bootstrap.bundle.min.js' %}" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    {% block script %}
    
    {% if user.is_authenticated %}
        <script type="text/javascript" src="{% static 'network/logged_in.js' %}"></script>
    {% else %}
        <script type="text/javascript" src="{% static 'network/logged_out.js' %}"></script>

    {% endif %}
    {% endblock %}
  
  </body>
</html>